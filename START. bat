@echo off
SET LookForFile=C:\proxycap\files\Registration.reg
goto check_Permissions
:check_Permissions
    net session >nul 2>&1
    if %errorLevel% == 0 (
        goto START
    ) else (
		echo Please run as administrator for the registry key to be updated automatically...
		TIMEOUT /T 5 >nul
		goto START
    )
	
:START
echo Terminating pcapui.exe...
taskkill /F /IM "pcapui.exe" >nul
cls
echo [Done] Terminating pcapui.exe...
echo Deleting previous extracted key...
del %LookForFile% >nul
cls	
echo [DONE] Terminating pcapui.exe...
echo [Done] Deleting previous extracted key...
echo Starting Windows Sandbox...
start %systemroot%\system32\WindowsSandbox.exe C:\proxycap\files\sandbox.wsb
cls
echo [DONE] Terminating pcapui.exe...
echo [DONE] Starting Windows Sandbox...
TIMEOUT /T 15 >nul
cls
echo [DONE] Terminating pcapui.exe...
echo [DONE] Starting Windows Sandbox...
echo Waiting for the new registry key to be extracted...

:CheckForFile
IF EXIST %LookForFile% GOTO FoundIt
TIMEOUT /T 2 >nul
GOTO CheckForFile

:FoundIt
cls
echo [DONE] Terminating pcapui.exe...
echo [DONE] Starting Windows Sandbox...
echo [DONE] Waiting for the new registry key to be extracted...
echo Terminating Windows Sandbox...
TIMEOUT /T 1 >nul
taskkill /F /IM "WindowsSandbox.exe" >nul
TIMEOUT /T 1 >nul
taskkill /F /IM "WindowsSandboxClient.exe" >nul
cls
echo [DONE] Terminating pcapui.exe...
echo [DONE] Starting Windows Sandbox...
echo [DONE] Waiting for the new registry key to be extracted...
echo [DONE] Terminating Windows Sandbox...

cls
echo [DONE] Terminating pcapui.exe...
echo [DONE] Starting Windows Sandbox...
echo [DONE] Waiting for the new registry key to be extracted...
echo [DONE] Terminating Windows Sandbox...
echo Importing the new registry key...
reg import %LookForFile%
TIMEOUT /T 3 >nul
cls
echo [DONE] Terminating pcapui.exe...
echo [DONE] Starting Windows Sandbox...
echo [DONE] Waiting for the new registry key to be extracted...
echo [DONE] Terminating Windows Sandbox...
echo [DONE] Importing the new registry key...
echo Starting pcapui.exe
start C:\Program Files\Proxy Labs\ProxyCap\pcapui.exe
cls
echo [DONE] Terminating pcapui.exe...
echo [DONE] Starting Windows Sandbox...
echo [DONE] Waiting for the new registry key to be extracted...
echo [DONE] Terminating Windows Sandbox...
echo [DONE] Importing the new registry key...
echo [DONE] Starting pcapui.exe
echo Exiting...
TIMEOUT /T 5 >nul

